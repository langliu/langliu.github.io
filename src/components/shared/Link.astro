---
import type { HTMLAttributes } from 'astro/types'

type Props = HTMLAttributes<'a'> & {
  label: string
  isUnderline?: boolean
}

const { label, isUnderline, target, rel, href, ...props } = Astro.props

// 判断是否为外部链接
const isExternal = href?.toString().startsWith('http')
// 如果没有指定 target，外部链接默认使用 _blank
const finalTarget = target || (isExternal ? '_blank' : undefined)
// 如果没有指定 rel，_blank 链接默认使用 noopener noreferrer
const finalRel = (() => {
  if (finalTarget !== '_blank') {
    return rel
  }

  const relTokens = new Set(
    rel
      ?.toString()
      .split(/\s+/)
      .map((token) => token.trim())
      .filter(Boolean) ?? [],
  )

  relTokens.add('noopener')
  relTokens.add('noreferrer')

  return Array.from(relTokens).join(' ')
})()
---

<a
  href={href}
  class:list={{
    ['hover:text-neutral-100 cursor-pointer']: true,
    ['underline decoration-dashed underline-offset-8']: isUnderline,
  }}
  {...props}
  rel={finalRel}
  target={finalTarget}
>
  {label}
</a>
