---
import Layout from '@/layouts/Layout.astro'
import PostListItem from '@/components/PostListItem.astro'
import { getPublishedPosts, type PostEntry } from '@/utils/posts'

export async function getStaticPaths() {
  const posts = await getPublishedPosts()

  // 获取所有唯一的分类
  const categories = [...new Set(posts.map((post) => post.data.category))]

  return categories.map((category) => ({
    params: { category },
    props: { category },
  }))
}

type Props = {
  category: PostEntry['data']['category']
}

const { category } = Astro.props as Props

// 获取该分类的所有文章
const posts = (await getPublishedPosts()).filter((post) => post.data.category === category)
---

<Layout title={`刘浪的博客 - ${category} 分类`}>
  <main class='flex flex-col gap-12'>
    <div class='flex flex-col gap-4'>
      <div class='flex items-center gap-2 text-sm text-neutral-500'>
        <a href='/categories' class='hover:text-neutral-300'>分类</a>
        <span>/</span>
        <span class='text-neutral-100'>{category}</span>
      </div>
      <h1 class='text-2xl text-neutral-100'>{category}</h1>
      <p class='text-neutral-400'>共 {posts.length} 篇文章</p>
    </div>

    <article class='flex flex-col gap-4'>
      {
        posts.map((post) => <PostListItem post={post} />)
      }
    </article>

    <div class='flex justify-center'>
      <a
        href='/categories'
        class='rounded-md border border-neutral-700 px-6 py-2 text-neutral-400 transition-all hover:border-neutral-400 hover:text-neutral-100'
      >
        查看所有分类
      </a>
    </div>
  </main>
</Layout>
