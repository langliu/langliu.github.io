---
title: 'SQL 语句中 where=1 的作用'
description: 'Lorem ipsum dolor sit amet'
publishDate: '2022-02-28'
heroImage: '/sql-where.jpg'
tags:
  - SQL
emoji: 🎉
draft: true
---

## 背景

最近接手了一个 NodeJS 的老项目，这个项目是 2017 年开始做的，没有用到像现在我们常用的 Prisma、TypeORM 或 Sequelize 这类 ORM 框架，是使用的原生的 T-SQL 语句进行查询，在熟悉代码的时候看到查询后有 `WHERE 1=1` 这段代码，感觉很疑惑不是很清楚这段代码在实际查询中有和意义，因为 `WHERE 1=1` 是永远为 `true`，应该起不到过滤查询的作用。难道它有我所不知道的用途？

## WHERE 1=1 是否改善了查询执行？

为了验证这个问题，我在数据库中进行了查询测试，结果发现无论加不加 `WHERE 1=1` ，查询所需的时间都是一致的，那说明 `WHERE 1=1` 并没有查询速度，那么为什么有这条语句呢？

## 方便后续 SQL 查询语句的拼接

继续研究代码后发现，往往这条语句后都伴随着些许条件查询，那么只有一种可能，这句语句就是单纯的为了方便 SQL 查询语句的拼接而诞生的。

因为后续的查询条件根据用户的实际操作可能会有一个或多个条件，当然也可能一个条件也没有，那么这时候只需要在这条 SQL 语句后根据传入的条件拼接 `AND A='%as%'` 之类的语句即可，而不需要再单独判断是否有查询条件。\

```sql
stmt  = "SELECT * "
stmt += "FROM TABLE "
stmt += "WHERE 1=1 "
if user chooses option a then stmt += "and A is not null "
if user chooses option b then stmt += "and B is not null "
if user chooses option b then stmt += "and C is not null "
if user chooses option b then stmt += "and D is not null "
```
