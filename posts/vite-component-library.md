---
title: 'å¿«é€Ÿåˆ›å»ºç»„ä»¶åº“ğŸš€'
publishedAt: 2024-05-01
description: 'å¿«é€Ÿåˆ›å»ºç»„ä»¶åº“ğŸš€ï¼ˆä½¿ç”¨Viteçš„åº“æ¨¡å¼ï¼‰'
slug: 'vite-component-library'
isPublish: false
---

å¦‚æœæ‚¨æ­£åœ¨ç®¡ç†å¤šä¸ª React åº”ç”¨ç¨‹åºå¹¶å¸Œæœ›ç”¨æˆ·ç•Œé¢ä¹‹é—´ä¿æŒä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ‚¨è¿Ÿæ—©ä¼šå‘ç°æ‚¨éœ€è¦ä¸€ä¸ªç»„ä»¶åº“ã€‚

å½“æˆ‘ç¬¬ä¸€æ¬¡æƒ³åˆ›å»ºä¸€ä¸ª React ç»„ä»¶åº“æ—¶ï¼Œæˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´æ‰æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³æˆ‘æ‰€æœ‰è¦æ±‚å¹¶ä¸”ä¸å¤ªå¤æ‚çš„è®¾ç½®ã€‚

åƒè¿™æ ·çš„æŒ‡å—å¯ä»¥è®©æˆ‘èŠ‚çœå¤§é‡çš„ç²¾åŠ›å»è§£å†³è¿™äº›é—®é¢˜ã€‚æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©ä½ ï¼Œå°±åƒå®ƒå¯¹æˆ‘æœ‰å¸®åŠ©ä¸€æ ·ã€‚

è¿™ç¯‡æ–‡ç« ä»‹ç»äº†è®¾ç½®å’Œå‘å¸ƒ React ç»„ä»¶åº“ï¼ŒåŒ…æ‹¬é…ç½®æ„å»ºè¿‡ç¨‹å¹¶å°†åŒ…å‘å¸ƒåˆ° npmï¼Œä»¥ä¾¿æ‚¨å’Œ/æˆ–å…¶ä»–äººå¯ä»¥ä½¿ç”¨å®ƒã€‚

**æˆ‘å·²å°½åŠ›ä¿æŒæ‰€æœ‰é…ç½®ç®€å•æ˜äº†ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚**

å®Œæˆåï¼Œæ‚¨å¯ä»¥åƒå®‰è£…ä»»ä½•å…¶ä»– npm åŒ…ä¸€æ ·å®‰è£…æ‚¨çš„åº“ï¼š

```bash
npm install @username/my-component-library
```

å¹¶åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š

```tsx
import { Button } from `@username/my-component-library`;

function MyComponent() {
  return <Button>Click me!</Button>
}
```

## æ–°å»ºä¸€ä¸ªViteé¡¹ç›®

å¦‚æœæ‚¨ä»æœªä½¿ç”¨è¿‡ Viteï¼Œè¯·å°†å…¶è§†ä¸º Create React App çš„æ›¿ä»£å“ã€‚åªéœ€å‡ ä¸ªå‘½ä»¤ï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹äº†ã€‚

```bash
npm create vite@latest
? Project name: â€º my-component-library
? Select a framework: â€º React
? Select a variant: â€º TypeScript
cd my-component-library
npm i
```

å°±è¿™æ ·ï¼Œæ‚¨çš„æ–° Vite/React é¡¹ç›®å·²å‡†å¤‡å°±ç»ªã€‚

## åŸºæœ¬æ„å»ºè®¾ç½®

æ‚¨ç°åœ¨å¯ä»¥è¿è¡Œ `npm run dev` å¹¶æµè§ˆåˆ° Vite æä¾›çš„ URLã€‚åœ¨å¤„ç†åº“æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤å¤„è½»æ¾å¯¼å…¥åº“å¹¶å®é™…æŸ¥çœ‹ç»„ä»¶ã€‚å°† `src` æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰ä»£ç è§†ä¸ºæ¼”ç¤ºé¡µé¢ã€‚

å®é™…çš„åº“ä»£ç å°†é©»ç•™åœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚è®©æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹å¹¶å°†å…¶å‘½åä¸º `lib` ã€‚æ‚¨ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œä¸åŒçš„å‘½åï¼Œä½† `lib` æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

åº“çš„ä¸»è¦å…¥å£ç‚¹å°†æ˜¯ `lib` å†…åä¸º `main.ts` çš„æ–‡ä»¶ã€‚å®‰è£…åº“æ—¶ï¼Œæ‚¨å¯ä»¥å¯¼å…¥ä»æ­¤æ–‡ä»¶å¯¼å‡ºçš„æ‰€æœ‰å†…å®¹ã€‚

```bash
ğŸ“‚my-component-library
 +â”£ ğŸ“‚lib
 +â”ƒ â”— ğŸ“œmain.ts
  â”£ ğŸ“‚public
  â”£ ğŸ“‚src
  â€¦
```

## Viteå›¾ä¹¦é¦†æ¨¡å¼

æ­¤æ—¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ `npm run build` æ„å»ºé¡¹ç›®ï¼ŒVite ä¼šå°† `src` ä¸­çš„ä»£ç è½¬è¯‘åˆ° `dist` æ–‡ä»¶å¤¹ä¸­ã€‚è¿™æ˜¯é»˜è®¤çš„ Vite è¡Œä¸ºã€‚

ç›®å‰ï¼Œæ‚¨å°†ä»…å°†æ¼”ç¤ºé¡µé¢ç”¨äºå¼€å‘ç›®çš„ã€‚æ‰€ä»¥è¿˜ä¸éœ€è¦è½¬è¯‘é¡¹ç›®çš„è¿™ä¸€éƒ¨åˆ†ã€‚ç›¸åï¼Œæ‚¨æƒ³è¦åœ¨ `lib` å†…è½¬è¯‘å’Œå‘é€ä»£ç ã€‚

è¿™å°±æ˜¯Viteçš„å›¾ä¹¦é¦†æ¨¡å¼å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å®ƒæ˜¯ä¸“é—¨ä¸ºæ„å»º/è½¬è¯‘åº“è€Œè®¾è®¡çš„ã€‚è¦æ¿€æ´»æ­¤æ¨¡å¼ï¼Œåªéœ€åœ¨ `vite.config.ts` ä¸­æŒ‡å®šæ‚¨çš„åº“å…¥å£ç‚¹å³å¯ã€‚

å°±åƒè¿™æ ·ï¼š

```ts
import { defineConfig } from 'vite'
import { resolve } from 'path'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  build: {
    lib: {
      entry: resolve(__dirname, 'lib/main.ts'),
      formats: ['es'],
    },
  },
})
```

> é»˜è®¤æ ¼å¼ä¸º 'es' å’Œ 'umd' ã€‚å¯¹äºæ‚¨çš„ç»„ä»¶åº“ï¼Œâ€œesâ€å°±æ˜¯æ‚¨æ‰€éœ€è¦çš„ã€‚è¿™ä¹Ÿæ¶ˆé™¤äº†æ·»åŠ  name å±æ€§çš„å¿…è¦æ€§ã€‚
> å¦‚æœä½ çš„ TypeScript linter æç¤º `path` å’Œ `__dirname` åªéœ€å®‰è£…èŠ‚ç‚¹çš„ç±»å‹ï¼š `npm i @types/node -D`

## TypeScript å’Œåº“æ¨¡å¼

Vite åˆ›å»ºçš„ `tsconfig.json` åªåŒ…å«æ–‡ä»¶å¤¹ `src` ã€‚è¦ä¸ºæ–°åˆ›å»ºçš„ `lib` æ–‡ä»¶å¤¹å¯ç”¨ TypeScriptï¼Œæ‚¨éœ€è¦å°†å…¶æ·»åŠ åˆ° TypeScript é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```json
"include": ["src", "lib"],
```

å°½ç®¡éœ€è¦ä¸º `src` å’Œ `lib` æ–‡ä»¶å¤¹å¯ç”¨ TypeScriptï¼Œä½†åœ¨æ„å»ºåº“æ—¶æœ€å¥½ä¸è¦åŒ…å« `src` ã€‚

ä¸ºäº†ç¡®ä¿åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä»…åŒ…å« `lib` ç›®å½•ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºæ„å»ºçš„å•ç‹¬çš„ TypeScript é…ç½®æ–‡ä»¶ã€‚

> ğŸ’¡ å®ç°è¿™ä¸ªå•ç‹¬çš„é…ç½®æœ‰åŠ©äºé¿å…å½“æ‚¨ç›´æ¥ä»æ¼”ç¤ºé¡µé¢ä¸Šçš„ `dist` æ–‡ä»¶å¤¹å¯¼å…¥ç»„ä»¶å¹¶ä¸”è¿™äº›ç»„ä»¶å°šæœªæ„å»ºæ—¶å‡ºç° TypeScript é”™è¯¯ã€‚

```
ğŸ“‚my-component-library
  â”£ â€¦
  â”£ ğŸ“œtsconfig.json
 +â”£ ğŸ“œtsconfig-build.json
  â€¦
```

å”¯ä¸€çš„åŒºåˆ«æ˜¯æ„å»ºé…ç½®ä»…åŒ…å« `lib` ç›®å½•ï¼Œè€Œé»˜è®¤é…ç½®åŒ…å« `lib` å’Œ `src`

```json
{
  "extends": "./tsconfig.json",
  "include": ["lib"]
}
```

è¦ä½¿ç”¨ `tsconfig-build.json` è¿›è¡Œæ„å»ºï¼Œæ‚¨éœ€è¦å°†é…ç½®æ–‡ä»¶ä¼ é€’ç»™ `package.json` ä¸­æ„å»ºè„šæœ¬ä¸­çš„ `tsc` ï¼š

```json
"build": "tsc --p ./tsconfig-build.json && vite build",
```

æœ€åï¼Œæ‚¨è¿˜éœ€è¦å°†æ–‡ä»¶ `vite-env.d.ts` ä» `src` å¤åˆ¶åˆ° `lib` ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼ŒTypescript å°†åœ¨æ„å»ºæ—¶é”™è¿‡ Vite æä¾›çš„ä¸€äº›ç±»å‹å®šä¹‰ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸å†åŒ…å« `src` ï¼‰ã€‚

æ‚¨ç°åœ¨å¯ä»¥å†æ¬¡æ‰§è¡Œ `npm run build` ï¼Œè¿™å°±æ˜¯æ‚¨å°†åœ¨ `dist` æ–‡ä»¶å¤¹ä¸­çœ‹åˆ°çš„å†…å®¹ï¼š

```bash
 ğŸ“‚dist
  â”£ ğŸ“œmy-component-library.js
  â”— ğŸ“œvite.svg
```

ğŸ’¡ è¾“å‡ºæ–‡ä»¶çš„åç§°é»˜è®¤ä¸ `package.json` ä¸­çš„ `name` å±æ€§ç›¸åŒã€‚è¿™å¯ä»¥åœ¨ Vite é…ç½®ï¼ˆ `build.lib.fileName` ï¼‰ä¸­æ›´æ”¹ï¼Œä½†æˆ‘ä»¬ç¨åä¼šå¯¹æ­¤åšä¸€äº›å…¶ä»–äº‹æƒ…ã€‚

æ–‡ä»¶ `vite.svg` ä½äºæ‚¨çš„ `dist` æ–‡ä»¶å¤¹ä¸­ï¼Œå› ä¸º Vite å°†æ‰€æœ‰æ–‡ä»¶ä» `public` ç›®å½•å¤åˆ¶åˆ°è¾“å‡ºæ–‡ä»¶å¤¹ã€‚è®©æˆ‘ä»¬ç¦ç”¨æ­¤è¡Œä¸ºï¼š

```json
build: {
  copyPublicDir: false
}
```

## æ„å»ºç±»å‹

ç”±äºè¿™æ˜¯ä¸€ä¸ª Typescript åº“ï¼Œæ‚¨è¿˜å¸Œæœ›éšåŒ…ä¸€èµ·æä¾›ç±»å‹å®šä¹‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ª Vite æ’ä»¶å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š[vite-plugin-dts](https://github.com/qmhc/vite-plugin-dts)

```bash
npm i vite-plugin-dts -D
```

é»˜è®¤æƒ…å†µä¸‹ dts å°†ä¸º `src` å’Œ `lib` ç”Ÿæˆç±»å‹ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹éƒ½åŒ…å«åœ¨é¡¹ç›®çš„ `.tsconfig` ä¸­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªé…ç½®å‚æ•°ï¼š `include: ['lib']`ã€‚

```ts
import dts from 'vite-plugin-dts'

...
  plugins: [react(), dts({ include: ['lib'] })]
...
```

> ğŸ’¡ å®ƒä¹Ÿé€‚ç”¨äº exclude: ['src'] æˆ–ä½¿ç”¨ä¸åŒçš„ Typescript é…ç½®æ–‡ä»¶è¿›è¡Œæ„å»ºã€‚

ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œè®©æˆ‘ä»¬å‘æ‚¨çš„åº“æ·»åŠ ä¸€äº›å®é™…ä»£ç ã€‚æ‰“å¼€ `lib/main.ts` å¹¶å¯¼å‡ºä¸€äº›å†…å®¹ï¼Œä¾‹å¦‚ï¼š

```ts
export function helloAnything(thing: string): string {
  return `Hello ${thing}!`
}
```

## æ²¡æœ‰ç»„ä»¶çš„Reactç»„ä»¶åº“æ˜¯ä»€ä¹ˆï¼Ÿ

ç°åœ¨æ‰“åŒ…çš„è¯Reactç»„ä»¶çš„å®ç°åŒ…å« React JSX ä»£ç ï¼Œå› æ­¤ react ï¼ˆå’Œ react/jsx-runtime ï¼‰ä¹Ÿè¢«æ†ç»‘åœ¨ä¸€èµ·ã€‚

ç”±äºè¯¥åº“å°†åœ¨å·²å®‰è£… React çš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤–éƒ¨åŒ–æ­¤ä¾èµ–é¡¹ä»¥ä»æ†ç»‘åŒ…ä¸­åˆ é™¤ä»£ç ï¼š

```ts
//vite.config.ts
  build: {
    â€¦
+   rollupOptions: {
+     external: ['react', 'react/jsx-runtime'],
+   }
  }
```

## å¯¼å…¥CSS

CSS æ–‡ä»¶æ— æ³•è½»æ¾å¯¼å…¥åˆ° JavaScript ä¸­ã€‚å› æ­¤ï¼ŒCSSæ–‡ä»¶æ˜¯å•ç‹¬ç”Ÿæˆçš„ï¼Œå…è®¸åº“ç”¨æˆ·å†³å®šå¦‚ä½•å¤„ç†è¯¥æ–‡ä»¶ã€‚

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å‡è®¾ä½¿ç”¨è¯¥åº“çš„åº”ç”¨ç¨‹åºå…·æœ‰å¯ä»¥å¤„ç† CSS å¯¼å…¥çš„æ†ç»‘å™¨é…ç½®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ

ä¸ºæ­¤ï¼Œè½¬è¯‘çš„ JavaScript åŒ…å¿…é¡»åŒ…å« CSS æ–‡ä»¶çš„å¯¼å…¥è¯­å¥ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å¦ä¸€ä¸ª Vite æ’ä»¶ï¼ˆ[vite-plugin-lib-inject-css](https://github.com/emosheeep/vite-plugin-lib-inject-css)ï¼‰ï¼Œå®ƒå¯ä»¥é€šè¿‡é›¶é…ç½®å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ã€‚

```bash
npm i vite-plugin-lib-inject-css -D
```

```ts
// vite.config.ts
+import { libInjectCss } from 'vite-plugin-lib-inject-css'
â€¦
  plugins: [
    react(),
+   libInjectCss(),
    dts({ include: ['lib'] })
  ],
â€¦
```

æ„å»ºåº“å¹¶æŸ¥çœ‹æ†ç»‘çš„ JavaScript æ–‡ä»¶çš„é¡¶éƒ¨ ( dist/my-component-library.js )ï¼š

```js
// dist/my-component-library.js
import "./main.css";
â€¦
```

## æ‹†åˆ† CSS

ä½†ä»ç„¶å­˜åœ¨ç¬¬äºŒä¸ªé—®é¢˜ï¼šå½“æ‚¨ä»åº“ä¸­å¯¼å…¥æŸäº›å†…å®¹æ—¶ï¼Œ `main.css` ä¹Ÿä¼šè¢«å¯¼å…¥ï¼Œå¹¶ä¸”æ‰€æœ‰ CSS æ ·å¼æœ€ç»ˆéƒ½ä¼šå‡ºç°åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºåŒ…ä¸­ã€‚å³ä½¿æ‚¨åªå¯¼å…¥æŒ‰é’®ã€‚

`libInjectCSS` æ’ä»¶ä¸ºæ¯ä¸ªå—ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ CSS æ–‡ä»¶ï¼Œå¹¶åœ¨æ¯ä¸ªå—çš„è¾“å‡ºæ–‡ä»¶çš„å¼€å¤´åŒ…å«ä¸€ä¸ª `import` è¯­å¥ã€‚

å› æ­¤ï¼Œå¦‚æœæ‚¨æ‹†åˆ† JavaScript ä»£ç ï¼Œæœ€ç»ˆä¼šå¾—åˆ°å•ç‹¬çš„ CSS æ–‡ä»¶ï¼Œåªæœ‰åœ¨å¯¼å…¥ç›¸åº”çš„ JavaScript æ–‡ä»¶æ—¶æ‰ä¼šå¯¼å…¥è¿™äº›æ–‡ä»¶ã€‚

åšåˆ°è¿™ä¸€ç‚¹çš„ä¸€ç§æ–¹æ³•æ˜¯å°†æ¯ä¸ªæ–‡ä»¶å˜æˆä¸€ä¸ª Rollup å…¥å£ç‚¹ã€‚è€Œä¸”ï¼Œå†å¥½ä¸è¿‡äº†ï¼Œ[Rollup æ–‡æ¡£](https://cn.rollupjs.org/configuration-options/#input)ä¸­æ¨èäº†ä¸€ç§æ­£ç¡®æ‰§è¡Œæ­¤æ“ä½œçš„æ–¹æ³•ï¼š

> ğŸ“˜ å¦‚æœæ‚¨æƒ³å°†ä¸€ç»„æ–‡ä»¶è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼ŒåŒæ—¶ä¿ç•™æ–‡ä»¶ç»“æ„å’Œå¯¼å‡ºç­¾åï¼Œå»ºè®®çš„æ–¹æ³•æ˜¯ï¼ˆè€Œä¸æ˜¯ä½¿ç”¨å¯èƒ½ä¼šæ‘‡åŠ¨å¯¼å‡ºå¹¶å‘å‡ºç”±æ’ä»¶åˆ›å»ºçš„è™šæ‹Ÿæ–‡ä»¶çš„ `output.preserveModules` ï¼‰ï¼šå°†æ¯ä¸ªæ–‡ä»¶å˜æˆä¸€ä¸ªå…¥å£ç‚¹ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ã€‚

```bash
npm i glob -D
```

ç„¶åå°†ä½ çš„ Vite é…ç½®æ›´æ”¹ä¸ºï¼š

```ts
// vite.config.ts
-import { resolve } from 'path'
+import { extname, relative, resolve } from 'path'
+import { fileURLToPath } from 'node:url'
+import { glob } from 'glob'
â€¦
    rollupOptions: {
      external: ['react', 'react/jsx-runtime'],
+     input: Object.fromEntries(
+       glob.sync('lib/**/*.{ts,tsx}').map(file => [
+         // The name of the entry point
+         // lib/nested/foo.ts becomes nested/foo
+         relative(
+           'lib',
+           file.slice(0, file.length - extname(file).length)
+         ),
+         // The absolute path to the entry file
+         // lib/nested/foo.ts becomes /project/lib/nested/foo.ts
+         fileURLToPath(new URL(file, import.meta.url))
+       ])
+     )
    }
â€¦
```

> ğŸ’¡ glob åº“å¯ä»¥å¸®åŠ©æ‚¨æŒ‡å®šä¸€ç»„æ–‡ä»¶åã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒé€‰æ‹©ä»¥ `.ts` æˆ– `.tsx` ç»“å°¾çš„æ‰€æœ‰æ–‡ä»¶

ç°åœ¨ï¼Œæ‚¨æœ€ç»ˆä¼šåœ¨ dist æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸­çœ‹åˆ°ä¸€å † JavaScript å’Œ CSS æ–‡ä»¶ã€‚å®ƒæœ‰æ•ˆï¼Œä½†çœ‹èµ·æ¥ä¸æ˜¯ç‰¹åˆ«æ¼‚äº®ï¼Œä¸æ˜¯å—ï¼Ÿ

```ts
// vite.config.ts
    rollupOptions: {
â€¦
+     output: {
+       assetFileNames: 'assets/[name][extname]',
+       entryFileNames: '[name].js',
+     }
    }
â€¦
```

å†æ¬¡è½¬è¯‘åº“ï¼Œæ‰€æœ‰ JavaScript æ–‡ä»¶ç°åœ¨åº”è¯¥ä½äºæ‚¨åœ¨ lib ä¸­åˆ›å»ºçš„ç›¸åŒç»„ç»‡æ–‡ä»¶å¤¹ç»“æ„åŠå…¶ç±»å‹å®šä¹‰ä¸­ã€‚ CSS æ–‡ä»¶ä½äºåä¸º asset çš„æ–°æ–‡ä»¶å¤¹ä¸­ã€‚

## å‘å¸ƒåŒ…ä¹‹å‰çš„æœ€åå‡ ä¸ªæ­¥éª¤

æ‚¨çš„æ„å»ºè®¾ç½®ç°å·²å‡†å¤‡å°±ç»ªï¼Œåœ¨å‘å¸ƒè½¯ä»¶åŒ…ä¹‹å‰åªéœ€è€ƒè™‘ä¸€äº›äº‹é¡¹ã€‚

package.json æ–‡ä»¶å°†ä¸æ‚¨çš„åŒ…æ–‡ä»¶ä¸€èµ·å‘å¸ƒã€‚æ‚¨éœ€è¦ç¡®ä¿å®ƒåŒ…å«æœ‰å…³åŒ…è£¹çš„æ‰€æœ‰é‡è¦ä¿¡æ¯ã€‚

### ä¸»æ–‡ä»¶

æ¯ä¸ª npm åŒ…éƒ½æœ‰ä¸€ä¸ªä¸»å…¥å£ç‚¹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ­¤æ–‡ä»¶ä½äºåŒ…æ ¹ç›®å½•ä¸­çš„ `index.js` ã€‚

æ‚¨çš„åº“çš„ä¸»è¦å…¥å£ç‚¹ç°åœ¨ä½äº `dist/main.js` ï¼Œå› æ­¤éœ€è¦åœ¨æ‚¨çš„ package.json ä¸­è®¾ç½®ã€‚è¿™åŒæ ·é€‚ç”¨äºç±»å‹çš„å…¥å£ç‚¹ï¼š `dist/main.d.ts`

```json
// package.json
{
  "name": "my-component-library",
  "private": true,
  "version": "0.0.0",
  "type": "module",
+ "main": "dist/main.js",
+ "types": "dist/main.d.ts",
  â€¦
```

### å®šä¹‰è¦å‘å¸ƒçš„æ–‡ä»¶

æ‚¨è¿˜åº”è¯¥å®šä¹‰å“ªäº›æ–‡ä»¶åº”è¯¥æ‰“åŒ…åˆ°æ‚¨çš„åˆ†å¸ƒå¼åŒ…ä¸­ã€‚

```json
// package.json
  â€¦
  "main": "dist/main.js",
  "types": "dist/main.d.ts",
+ "files": [
+   "dist"
+ ],
  â€¦
```

### ä¾èµ–å…³ç³»

ç°åœ¨çœ‹çœ‹æ‚¨çš„ `dependencies` ï¼šç°åœ¨åº”è¯¥åªæœ‰ä¸¤ä¸ª `react` å’Œ `react-dom` ä»¥åŠå‡ ä¸ª `devDependencies` ã€‚

æ‚¨ä¹Ÿå¯ä»¥å°†è¿™ä¸¤ä¸ªç§»åŠ¨åˆ° `devDepedencies` ã€‚å¦å¤–å°†å®ƒä»¬æ·»åŠ ä¸º `peerDependencies` ï¼Œä»¥ä¾¿ä½¿ç”¨åº”ç”¨ç¨‹åºçŸ¥é“å®ƒå¿…é¡»å®‰è£… React æ‰èƒ½ä½¿ç”¨æ­¤åŒ…ã€‚

```json
// package.json
- "dependencies": {
+ "peerDependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
+   "react": "^18.2.0",
+   "react-dom": "^18.2.0",
    â€¦
  }
```

### å‰¯ä½œç”¨

ä¸ºäº†é˜²æ­¢ CSS æ–‡ä»¶è¢«æ¶ˆè´¹è€…çš„ tree-shaking æ“ä½œæ„å¤–åˆ é™¤ï¼Œæ‚¨è¿˜åº”è¯¥å°†ç”Ÿæˆçš„ CSS æŒ‡å®šä¸ºå‰¯ä½œç”¨ï¼š

```json
// package.json
+ "sideEffects": [
+   "**/*.css"
+ ],
```

### ç¡®ä¿åŒ…å·²æ„å»º

æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸè„šæœ¬ `prepublishOnly` æ¥ä¿è¯æ‚¨çš„æ›´æ”¹å§‹ç»ˆåœ¨åŒ…å‘å¸ƒä¹‹å‰æ„å»ºï¼š

```json
// package.json
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    â€¦
+   "prepublishOnly": "npm run build"
  },
```
