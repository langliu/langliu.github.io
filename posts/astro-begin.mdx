---
title: 'åŸºäº Astro æ­å»ºåšå®¢ç³»ç»Ÿ'
description: 'åŸºäº Astro æ­å»ºåšå®¢ç³»ç»Ÿ'
publishedAt: 2022-09-08
tags:
  - JavaScript
slug: astro-begin
isPublish: true
category: 'HTML'
---

## ç¼˜èµ·

æœ€è¿‘åœ¨å°‘æ•°æ´¾çœ‹è§ä¸€ç¯‡æ–‡ç«  [æŠ›å¼ƒçŸ¥è¯†ç®¡ç†è½¯ä»¶çš„å°è¯•ï¼šæŠŠåšå®¢å˜ä¸ºçŸ¥è¯†åº“](https://sspai.com/post/75329)ï¼Œä½œè€…å°è¯•äº†ä¸ä½¿ç”¨çŸ¥è¯†ç®¡ç†è½¯ä»¶è€Œä½¿ç”¨é™æ€åšå®¢ç³»ç»Ÿæ¥ç®¡ç†è‡ªå·±çš„çŸ¥è¯†åº“ï¼Œæ°å·§æœ€è¿‘çœ‹è§äº† [Astro](https://astro.build/) å‘å¸ƒäº†1.0ç‰ˆæœ¬ï¼Œæƒ³è¦å°è¯•ä¸€ä¸‹äºæ˜¯å†³å®šåŸºäº Astro æ­å»ºä¸€ä¸ªè‡ªå·±çš„åšå®¢ç³»ç»Ÿï¼Œä½¿ç”¨ Github Page æ¥åšé™æ€ç½‘é¡µæœåŠ¡ã€‚

## åšå®¢æ­å»º

> ğŸ’¡åœ¨æ­å»ºå‰å…ˆçœ‹ä¸€ä¸‹ [Astro çš„å®˜æ–¹æ–‡æ¡£](https://docs.astro.build/zh-cn/getting-started/)ï¼Œäº†è§£ä¸€ä¸‹æä¾›äº†å“ªäº›åŠŸèƒ½ï¼ŒAstro å®˜æ–¹æ–‡æ¡£æä¾›äº†ä¸­æ–‡ç‰ˆæœ¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹ã€‚

### å‰ç½®å‡†å¤‡

ä½¿ç”¨ Astro ç›®å‰åªæœ‰ä½¿ç”¨ VSCode ç¼–è¾‘å™¨æ‰æœ‰ä¸€ä¸ªè¾ƒä¸ºè‰¯å¥½çš„å¼€å‘ä½“éªŒï¼Œå› ä¸ºå®˜æ–¹ç›®å‰åªæä¾›äº†åŸºäº VSCode çš„æ’ä»¶ [Astro](https://marketplace.visualstudio.com/items?itemName=astro-build.astro-vscode)

### é¡¹ç›®åˆ›å»º

```shell
# npm
npm create astro@latest

# yarn
yarn create astro

# pnpm
pnpm create astro@latest
```

æ‰§è¡Œä»¥ä¸Šå‘½ä»¤åï¼ŒAstro ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å¹¶åˆå§‹åŒ–é¡¹ç›®ã€‚

#### ç›®å½•ç»“æ„

ä¸€ä¸ªå¯»å¸¸çš„ Astro é¡¹ç›®ç›®å½•å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š
- src/* - ä½ çš„é¡¹ç›®æºä»£ç ï¼ˆç»„ä»¶ã€é¡µé¢ã€æ ·å¼ç­‰ï¼‰ã€‚
- public/* - ä½ çš„éä»£ç ã€æœªå¤„ç†çš„èµ„æºï¼ˆå­—ä½“ã€å›¾æ ‡ç­‰ï¼‰ã€‚
- package.json - é¡¹ç›®åˆ—è¡¨ã€‚
- astro.config.mjs - Astro é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ã€‚

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Header.astro
â”‚   â”‚   â””-â”€ Button.jsx
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””-â”€ PostLayout.astro
â”‚   â””â”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â”‚   â”œâ”€â”€ post1.md
â”‚   â”‚   â”‚   â”œâ”€â”€ post2.md
â”‚   â”‚   â”‚   â””â”€â”€ post3.md
â”‚   â”‚   â””â”€â”€ index.astro
â”‚   â””â”€â”€ styles/
â”‚       â””-â”€ global.css
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ robots.txt
â”‚   â”œâ”€â”€ favicon.svg
â”‚   â””-â”€ social-image.png
â”œâ”€â”€ astro.config.mjs
â””â”€â”€ package.json
```

### astro æ–‡ä»¶ç»“æ„

astro æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š**ç»„ä»¶ script** å’Œ**ç»„ä»¶æ¨¡æ¿**ï¼Œå†™è¿‡Vueçš„åŒå­¦å¯èƒ½å¯¹è¿™ç§ç»“æ„æ¯”è¾ƒç†Ÿæ‚‰ï¼š

```js
---
// ç»„ä»¶ Scriptï¼ˆJavaScriptï¼‰
---
<!-- Component Template (HTML + JS Expressions) -->
```

#### ç»„ä»¶ Script

Astro ä½¿ç”¨ä»£ç æ …æ ï¼ˆ---ï¼‰æ¥è¯†åˆ« Astro ç»„ä»¶ä¸­çš„ç»„ä»¶ scriptã€‚

ä½ å¯ä»¥ä½¿ç”¨ç»„ä»¶ script æ¥ç¼–å†™æ¸²æŸ“æ¨¡æ¿æ‰€éœ€ JavaScript ä»£ç ã€‚è¿™å¯ä»¥åŒ…æ‹¬ï¼š

- å¯¼å…¥å…¶ä»– Astro ç»„ä»¶
- å¯¼å…¥å…¶ä»–æ¡†æ¶ç»„ä»¶ï¼Œå¦‚ React
- å¯¼å…¥æ•°æ®ï¼Œå¦‚ JSON æ–‡ä»¶
- ä» API æˆ–æ•°æ®åº“ä¸­è·å–å†…å®¹
- åˆ›å»ºä½ è¦åœ¨æ¨¡æ¿ä¸­å¼•ç”¨çš„å˜é‡

ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº†ä¸€ä¸ª Tag çš„ Astro ç»„ä»¶ï¼Œå¹¶ä¸”è¯»å–äº† `src/pages/posts` æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ Markdown å’Œ MDX æ–‡ä»¶ï¼š

```js
---
import Tag from './Tag.astro'
// Use Astro.glob() to fetch all posts, and then sort them by date.
const posts = (await Astro.glob('../pages/posts/**/*.{md,mdx}')).sort(
  (a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf()
)
---
```

#### ç»„ä»¶æ¨¡æ¿

Astro çš„ç»„ä»¶æ¨¡æ¿æ”¯æŒJSXè¡¨è¾¾å¼ï¼ˆæ²¡æœ‰åªèƒ½æœ‰ä¸€ä¸ªæœ€å¤–å±‚æ ‡ç­¾å…ƒç´ çš„è¦æ±‚ï¼‰ï¼Œå¯ä»¥é€šè¿‡ `<slot />` æ’æ§½æ”¯æŒå°†å…¶ä»–ç»„ä»¶åµŒå…¥åˆ°å½“å‰ç»„ä»¶æ¨¡æ¿ä¸­

```js
---
import Tag from '@components/Tag.astro'
type Props = {
  emoji?: string
  title?: string
  tags?: string[]
  publishDate?: string
  url?: string
}

const { url, emoji, title, publishDate, tags } = Astro.props as Props
---

<li>
  <a href={url}>
    <span class='title'>
      {emoji}
      {title}
    </span>
    <div>
      {tags?.map((tag: string) => <Tag text={tag} />)}
      <time datetime={publishDate}>
        {
          new Date(publishDate ?? new Date()).toLocaleDateString('zh-CN', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
          })
        }
      </time>
    </div>
  </a>
</li>

<style>
  li {
    color: var(--theme-ui-colors-primary, white);
    box-sizing: border-box;
    min-width: 0px;
    padding: 0.5rem;
    border-radius: 0.25rem;
    display: flex;
    transition: all 200ms ease-in-out 0s;
    -webkit-box-pack: justify;
    justify-content: space-between;
    overflow: hidden;
  }

  li:hover {
    background-color: var(--theme-ui-colors-codeBackground, hsl(285, 5%, 17%));
  }

  li > a {
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-decoration: none;
    color: white;
  }

  .title {
    box-sizing: border-box;
    line-height: 1.25;
    position: relative;
    font-size: 1rem;
    margin: 0px 1rem 0px 0px;
    font-weight: 700;
    color: var(--theme-ui-colors-textStrong, hsl(210, 38%, 98%));
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
    min-width: 260px;
  }

  li time {
    box-sizing: border-box;
    margin: 0px 0px 0px 0.5rem;
    min-width: 0px;
    font-size: 0.7rem;
    color: var(--theme-ui-colors-text, hsl(210, 17%, 85%));
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>

```

### ç¬¬ä¸€ç¯‡æ–‡ç« 

åŸºæœ¬æ¡†æ¶æ­å¥½ä¹‹åå°±å¯ä»¥è¿›è¡Œæ–‡ç« å†™ä½œäº†ï¼Œåœ¨srcçš„postsç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª Markdown æ–‡ä»¶ï¼Œåœ¨ Markdown ä¸­å†™ä½œï¼Œç„¶åè¿è¡Œ `npm run dev`ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€é“¾æ¥ http://localhost:3000/posts/æ–‡ç« æ ‡é¢˜ å³å¯å¯¹æ–‡ç« è¿›è¡Œé¢„è§ˆã€‚

### å¸ƒå±€è®¾è®¡

æŒ‰ç…§é€šå¸¸çš„åšå®¢ï¼Œéƒ½ä¼šæœ‰ä¸€äº›é€šç”¨çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ src ç›®å½•ä¸‹æ–°å»ºè¿™äº›å¸ƒå±€æ–‡ä»¶ï¼Œæœ€ç®€å•çš„å¸ƒå±€åŸºæœ¬åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼š

- é¡¶éƒ¨æˆ–ä¾§è¾¹çš„å¯¼èˆªæ 
- ä¸»ä½“åŒºåŸŸ
- é¡µè„šï¼ˆé€šå¸¸ç”¨äºé…ç½®å¤‡æ¡ˆä¿¡æ¯ç­‰ï¼‰

> å› ä¸º Astro é»˜è®¤æ˜¯æŒ‰ç…§æ–‡ä»¶ç›®å½•è®¾ç½®è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ markdown/mdx æ–‡ä»¶ä¸­éœ€è¦åœ¨æ–‡ä»¶é¡¶éƒ¨æ‰‹åŠ¨å£°æ˜ä½¿ç”¨çš„å¸ƒå±€ï¼Œä¾‹å¦‚ `layout: '@layouts/BlogPost.astro'`


### æ–‡ç« åˆ—è¡¨é¡µè®¾è®¡

Astro æä¾›äº† `glob` APIç”¨äºè·å–æœ¬åœ°ç›¸å…³æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä¾‹å­è·å–æ‰€æœ‰çš„ markdown/mdx æ–‡ä»¶ï¼Œè·å–æ‰€æœ‰æ–‡ç« åå¯ä»¥é€šè¿‡ `frontmatter` å­—æ®µæ¥è·å–æ–‡ç« çš„ç›¸å…³ä¿¡æ¯ã€‚

```js
const posts = (await Astro.glob('../pages/posts/**/*.{md,mdx}')).sort(
  (a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf()
)
```

> åœ¨ markdown/mdx æ–‡ä»¶é¡¶éƒ¨é€šå¸¸ä¼šå£°æ˜æ–‡ç« çš„ä¸€äº›ç®€è¦ä¿¡æ¯ï¼Œå­—æ®µå¯ä»¥è‡ªå®šä¹‰ï¼Œé€šè¿‡ `frontmatter` å­—æ®µå¯ä»¥æ‹¿åˆ°è¿™äº›å£°æ˜çš„å­—æ®µï¼š
> ```js
> ---
>
> title: 'Windows ä¸‹ä½¿ç”¨7-Zipæ‰¹é‡å‹ç¼©æ–‡ä»¶å¤¹'
> description: 'Windows ä¸‹ä½¿ç”¨7-Zipæ‰¹é‡å‹ç¼©æ–‡ä»¶å¤¹'
> publishDate: '2022-09-03'
> heroImage: '/7-zip-batch-compression.png'
> tags:
>   - Tools
>   - 7-Zip
> emoji: ğŸ˜
> ---
> ```

### æ–‡ç« å¸ƒå±€é¡µè®¾è®¡

è·¯ç”±åœ¨è®¿é—®åˆ°æ–‡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœ markdown/mdx æ–‡ä»¶æœ‰æŒ‡å®šå¸ƒå±€ï¼Œåˆ™ä¼šå°†æ–‡ç« çš„ç›¸å…³ä¿¡æ¯é€šè¿‡å‚æ•°çš„æ–¹å¼ä¼ å…¥å¸ƒå±€ç»„ä»¶ï¼Œæ–‡ç« ä¸»ä½“é€šè¿‡ <slot/> æ³¨å…¥åˆ°å¸ƒå±€ç»„ä»¶ä¸­ï¼Œåœ¨è®¾è®¡æ–‡ç« å¸ƒå±€é¡µæ˜¯ï¼Œé¦–å…ˆè¦çŸ¥é“å‚æ•°æ˜¯å¦‚ä½•ä¼ å…¥çš„ï¼ˆå¯ä»¥å‚è€ƒä¸‹é¢çš„ç±»å‹å®šä¹‰ï¼‰

```ts
export interface Heading {
  depth: number
  slug: string
  text: string
}
export interface Props {
  content: {
    title: string
    description: string
    publishDate?: string
    updatedDate?: string
    heroImage?: string
    tags?: string[]
  }
  headings: Heading[]
}

const {
  content: { title, description, publishDate, updatedDate, heroImage, tags },
  headings,
} = Astro.props as Props
```

> è¿™é‡Œå®šä¹‰çš„ `Heading` æ˜¯æ–‡ç« çš„ç›®å½•å±‚çº§

### æ ‡ç­¾é¡µè®¾è®¡

æ ‡ç­¾é¡µè®¾è®¡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ‡ç­¾åˆ—è¡¨é¡µåŠæ ‡ç­¾æ–‡ç« é¡µã€‚

#### æ ‡ç­¾åˆ—è¡¨é¡µ

æ ‡ç­¾åˆ—è¡¨é¡µå¯ä»¥é€šè¿‡æŸ¥è¯¢æ‰€æœ‰æ–‡ç« ç„¶åè·å–åˆ°æ‰€æœ‰çš„æ ‡ç­¾ï¼Œå¯¹è·å–åˆ°çš„æ ‡ç­¾è¿›è¡Œå”¯ä¸€å€¼è¿‡æ»¤ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
const posts = (await Astro.glob('../pages/posts/*.{md,mdx}'))
let tags: string[] = []
posts.forEach((post) => {
  tags = [...tags, ...post.frontmatter.tags]
})
tags = [...new Set(tags)]
```

#### æ ‡ç­¾æ–‡ç« é¡µ

- `pages/tags/[tag].astro` â†’ (`/tags/hello-world`, `/tags/post-2`, etc.)

ç‚¹å‡»æŸä¸ªæ ‡ç­¾ï¼Œéœ€è¦æŸ¥çœ‹åˆ°æ‰€æœ‰åŒ…å«è¿™ä¸ªæ ‡ç­¾çš„æ–‡ç« åˆ—è¡¨ï¼Œå“ªä¹ˆè¿›å…¥é¡µé¢åå¦‚ä½•çŸ¥é“å½“å‰æ˜¯å“ªä¸ªæ ‡ç­¾å‘¢ï¼Ÿè¿™æ˜¯å°±éœ€è¦ä½¿ç”¨åˆ° Astro çš„åŠ¨æ€è·¯ç”±äº†ï¼ŒåŠ¨æ€ç”Ÿæˆè·¯ç”±çš„ Astro ç»„ä»¶å¯ä»¥è®¿é—®æ¯ä¸ªè·¯ç”±çš„ `Astro.params` å¯¹è±¡ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨ç»„ä»¶è„šæœ¬å’Œæ¨¡æ¿ä¸­ä½¿ç”¨é‚£äº›ç”Ÿæˆçš„é“¾æ¥éƒ¨åˆ†ã€‚ä»£ç å¦‚ä¸‹ï¼š


```ts
type Props = {
  /** æ ‡ç­¾åç§° */
  tag: string
}

export async function getStaticPaths() {
  let tags: string[] = []
  const posts = (await Astro.glob('../../pages/posts/**/*.{md,mdx}'))

  posts.forEach((post) => {
    tags = [...tags, ...post.frontmatter.tags]
  })
  tags = [...new Set(tags)]
  return tags.map((tag) => ({ params: { tag } }))
}

const { tag } = Astro.params as Props
```

> `getStaticPaths` æ–¹æ³•æ˜¯å¿…é¡»çš„ï¼Œæä¾›è¦ä½¿ç”¨çš„å€¼æ¥ç”Ÿæˆå¸¦æœ‰ [named] å‚æ•°çš„è·¯ç”±ã€‚

## ç¾åŒ–

### ä»£ç å—ç¾åŒ–

Astro é»˜è®¤æä¾›äº† shiki ç›¸å…³é…ç½®ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å³å¯äº«æœ‰ shiki æ”¯æŒçš„ä»£ç ä¸»é¢˜ï¼š

```js
export default {
  markdown: {
    shikiConfig: {
      // Choose from Shiki's built-in themes (or add your own)
      // https://github.com/shikijs/shiki/blob/main/docs/themes.md
      theme: 'dracula',
      // Add custom languages
      // Note: Shiki has countless langs built-in, including .astro!
      // https://github.com/shikijs/shiki/blob/main/docs/languages.md
      langs: [],
      // Enable word wrap to prevent horizontal scrolling
      wrap: true,
    },
  },
};
```

### å­—ä½“ç¾åŒ–

åœ¨ä»£ç å—ä¸­æˆ‘ä»¬å¯èƒ½æƒ³ä½¿ç”¨ä¸€äº›å­—ä½“æ¥è®©æ˜¾ç¤ºæ•ˆæœè¾¾åˆ°å’Œå¼€å‘æ—¶æœ¬åœ°é…ç½®ç›¸è¿‘ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨è¿å­—ç¬¦å’Œç­‰å®½å­—ä½“ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ [Fontsource](https://fontsource.org/) æ¥åŠ è½½ç½‘ç»œå­—ä½“ï¼Œåœ¨å­—ä½“é¢æ¿æ‰¾åˆ°æƒ³è¦çš„å­—ä½“ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ [Jetbrains Mono](https://fontsource.org/fonts/jetbrains-mono) å­—ä½“:

#### å®‰è£…ä¾èµ–

```shell
npm install @fontsource/jetbrains-mono
```

#### å¼•å…¥

```js
import "@fontsource/jetbrains-mono"
```

> ç›®å‰å¼•å…¥å­—ä½“çš„æ—¶å€™é‡è§äº†ä¸€ä¸ªé—®é¢˜ï¼Œé€šè¿‡ js çš„æ–¹å¼å¼•å…¥åï¼Œåœ¨æ‰“åŒ…æ—¶ä¼šæŠ¥é”™ï¼Œå…·ä½“ä»€ä¹ˆåŸå› æ²¡æœ‰ææ¸…æ¥šï¼Œä½†æ˜¯æ¢ä¸ºé€šè¿‡ CSS `@import` å¼•å…¥åˆ™æ²¡æœ‰é—®é¢˜ `@import '@fontsource/jetbrains-mono';`

#### ä½¿ç”¨å­—ä½“

```css
:global(code) {
  font-family: 'JetBrains Mono', monospace;
}
```

## éƒ¨ç½²

Astro å®˜æ–¹æ–‡æ¡£ä¸­æä¾›äº†å¤šä¸ªå¹³å°çš„[éƒ¨ç½²æ–¹å¼](https://docs.astro.build/zh-cn/guides/deploy/)ï¼Œæ¯”å¦‚å¦‚æœæƒ³è¦éƒ¨ç½²åˆ°Github Page å®˜æ–¹ä¹Ÿæä¾›äº†ä¸“é—¨çš„Actionç”¨äºéƒ¨ç½²ï¼š

```yaml
name: Github Pages Astro CI

on:
  # Trigger the workflow every time you push to the `main` branch
  # Using a different branch name? Replace `main` with your branchâ€™s name
  push:
    branches: [ main ]
  # Allows you to run this workflow manually from the Actions tab on GitHub.
  workflow_dispatch:

# Allow this job to clone the repo and create a page deployment
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout your repository using git
        uses: actions/checkout@v2
      - name: Install, build, and upload your site
        uses: withastro/action@v0

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
```
